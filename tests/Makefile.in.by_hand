# $Id: Makefile.in,v 1.12 2005/03/30 23:09:06 jimg Exp $

@SET_MAKE@

# Set makefile variables, some with values supplied by configure 
# DEFS gets the `-D' defines that describe what a particular system has
# or doesn't have.

PROGS = arrayT attrTableT structT sequenceT ddsT ddsPT iterT

# dods_relative ends in a slash. 5/14/2001 jhrg
DODS_ROOT = ../../../

INCS = -I. -I.. -I../GNU -I$(DODS_ROOT)include @INCS@ $(CPP_UNIT_INC)
DEFS = @DEFS@ -DDEFAULT_BASETYPE_FACTORY
CPPFLAGS = @CPPFLAGS@ $(DEFS) $(INCS)
# Use these options for debugging. 12/24/02 jhrg
CXXFLAGS_DEBUG = -g3 -O0 -Wall -fno-default-inline -fno-defer-pop
CXXFLAGS = @CXXFLAGS@ -Wall -Wno-deprecated
LDFLAGS = -L.. -L$(DODS_ROOT)lib @LDFLAGS@ $(CPP_UNIT_LIB)
TAGS_FLAGS =
LIBS = @LIBS@

SHELL = /bin/sh
srcdir = @srcdir@
version = @VERSION@
basedir = dap
dir = $(basedir)-$(version)
host = @host@

COMPONENT_NAME = DODS Core

# testsuite specifics
RUNTEST = ./runme

# names of key programs

LN_S = @LN_S@
CP = cp
AWK = @AWK@
TAR = @TAR@
PERL = @PERL@
CC = @CC@
CXX = @CXX@
PURIFY = purify -chain-length="10"
YACC = @YACC@
LEX = @LEX@
AR = ar
TAGS = etags
RANLIB = @RANLIB@
STRIP = strip
VALGRIND = @VALGRIND@

# SRCS = LongIterAdapter.cc TestArray.cc TestSequence.cc \
#       Unused.cc arrayT.cc attrTableT.cc ddsPT.cc \
#       ddsT.cc iterT.cc sequenceT.cc structT.cc
#
#OBJS = TestArray.o TestSequence.o Unused.o ../TestInt16.o ../TestStr.o \
#       ../TestStructure.o ../TestCommon.o
#
#AOBJS = TestArray.o TestSequence.o ../TestInt16.o ../TestStr.o \
#	../TestStructure.o ../TestFloat64.o ../TestInt32.o \
#	../TestUInt32.o ../TestByte.o ../TestGrid.o \
#        ../TestUrl.o ../TestFloat32.o ../TestUInt16.o ../TestCommon.o

RCS = LongIterAdapter.cc \
       arrayT.cc attrTableT.cc ddsPT.cc \
       ddsT.cc iterT.cc sequenceT.cc structT.cc

all: runtest

runtest: $(PROGS)
	-for t in $(PROGS); do echo $$t; $(VALGRIND) ./$$t; done
	-rm memcheck
	-for m in `ls -1 memcheck.pid*`; do cat $$m >> memcheck; rm $$m; done

#	./arrayT
#	./attrTableT
#	./structT
#	./sequenceT
#	./ddsT
#	./ddsPT
#	./iterT

# geturl is really a test driver, but it is so useful in other contexts that
# I have decided to build it as part of the `all' target. jhrg 7/11/96

arrayT : ../libdap++.a arrayT.o $(OBJS)
	$(CXX) $(LDFLAGS) -o arrayT arrayT.o $(OBJS) -lcppunit -ldap++ -ltest-types++ $(LIBS)

attrTableT : ../libdap++.a attrTableT.o $(OBJS)
	$(CXX) $(LDFLAGS) -o attrTableT attrTableT.o $(OBJS) -lcppunit -ldap++ -ltest-types++ $(LIBS)

structT : ../libdap++.a structT.o $(OBJS)
	$(CXX) $(LDFLAGS) -o structT structT.o $(OBJS) -lcppunit -ldap++ -ltest-types++ $(LIBS)

sequenceT : ../libdap++.a sequenceT.o $(OBJS)
	$(CXX) $(LDFLAGS) -o sequenceT sequenceT.o $(OBJS) -lcppunit -ldap++ -ltest-types++ $(LIBS)

ddsT : ../libdap++.a ddsT.o $(OBJS)
	$(CXX) $(LDFLAGS) -o ddsT ddsT.o $(OBJS) -lcppunit -ldap++ -ltest-types++ $(LIBS)

ddsPT : ../libdap++.a ddsPT.o $(AOBJS)
	$(CXX) $(LDFLAGS) -o ddsPT ddsPT.o $(AOBJS) -lcppunit -ldap++ -ltest-types++ $(LIBS)

iterT : ../libdap++.a iterT.o LongIterAdapter.o $(OBJS)
	$(CXX) $(LDFLAGS) -o iterT iterT.o LongIterAdapter.o $(OBJS) -lcppunit -ldap++ -ltest-types++ $(LIBS)

# Standard targets

Makefile: Makefile.in
	if [ -x ../config.status ]; \
	then \
	    (cd .. && ${SHELL} ./config.status;) \
	else \
	    (cd .. && ./configure;) \
	fi \

# Clean up.

clean:	
	-rm -f *.o *.sum *.log *~ core
	-rm -f *.bb *.bbg *.da *.gcov
	-rm -f $(PROGS)

distclean: clean

.PHONY: tags
tags:
	$(TAGS) $(TAGS_FLAGS) *.cc *.h *.lex *.y

.PHONY: depend
depend: 
	../@depend@ -m Makefile.in -- $(CPPFLAGS) -- $(SRCS)

# Once the unit tests are working, add this to the sources on which we run
# depend. 
# $(UNIT_TEST_SRC)

.SUFFIXES:      .o .cc .c

.c.o:
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $<

.cc.o:
	$(CXX) -c $(CXXFLAGS) $(CPPFLAGS) -o $@ $<

# DO NOT DELETE; depend requires this line
